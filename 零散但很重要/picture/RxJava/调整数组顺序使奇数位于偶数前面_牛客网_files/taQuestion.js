define("nowcoder/1.2.1185/javascripts/site/ta/taQuestion",["nc","cpn","ncpc","../../core/siteConfig","../../util/littleAction","../../action/contest","../../action/note","../../component/popupSub/popupCommon","../../action/question"],function(t,e,i){var o,d,n=t("nc"),a=t("cpn"),r=t("ncpc"),w=n.$,s=n.Db,j=n.Event,u=n.DragDrop,I=n.Str,l=n.Sys,C=n.Base,T=n.Uri,x=n.Dom,c=n.Sound,f=n.CodeLang,h=n.MathJax,p=a.Popup,g=r.Code,m=r.Util,v=t("../../core/siteConfig"),E=t("../../util/littleAction"),y=t("../../component/popupSub/popupCommon"),b=t("../../action/question"),H="data-drag",q=new c("//uploadfiles.nowcoder.com/acts/acm_pass.wav");l.ready({initialize:function z(){var e=this;m.getEditor(["codeEditor","codeFEEditor"],function(t){o=t.codeEditor,d=t.codeFEEditor,e.initData(),e.initUi(),e.initFold(),e.initSubmitMode(),e.initAction(),e.initEditor(),e.initResize(),e.initMenu(),e.initDragDrop(),e.initDragSplit(),h.image(w(".js-left"))})},initData:function S(){var t=this;t.resultEl=w(".js-right-bottom"),C.copy(t,window,["pageInfo"]),t.uuid=t.pageInfo.uuid||"",t.nextTqId=+t.pageInfo.nextTqId||0,t.nextTqUuid=t.pageInfo.nextTqUuid||"",t.tPage=+t.pageInfo.tPage||0,t.tpId=+t.pageInfo.tpId||0,t.topicTitle=t.pageInfo.topicTitle||""},initUi:function M(){"0"===this.pageInfo.codeJudgeType&&w(".js-nk-warning").show()},initFold:function P(){var n=this;w(document).on("click",".js-fold",function(t){var e=w(t.currentTarget),i=e.find("a");n.openTab(i.hasClass("icon-angle-up"))})},initSubmitMode:function A(){var n=this,t=w(".js-sumit-type");if(0===t.length)return;var i=t.find(".js-sumit-type-result");function o(){var t=n.codeEditor,e=n.valExamMode();i.html(e?'<i class="model-channel-icon2"></i> 考试模式':'<i class="model-channel-icon1"></i> 练习模式'),t&&C.extend(t.rawConfig.statusExtParam,{isContestExercise:e?"true":undefined})}o(),t.show(),t.on("click",".model-channel-pop .model-channel-item",function(t){var e=w(t.currentTarget),i="1"===w.trim(e.attr("data-type"));n.valExamMode(i),o(),p.alert(i?"你已成功进入考试模式！！该模式下提交错误代码不再有测试用例数据提示。为适应考试，请进行在线编码，不使用本地IDE。":"你已成功进入练习模式！！该模式下提交错误代码可反馈测试用例数据。快快开始练习吧！")})},initAction:function D(){var t=this.pageInfo.questionId,e=v.type.problem;g.onlineJudgeHelp({el:w("a.js-coding-help")}),E.correction({el:w("a.click-correction"),entityId:t,entityType:e}),E.follow({followCls:"js-click-follow",unfollowCls:"js-click-unfollow",followStr:"收藏",entityId:t,entityType:e}),E.note({editCls:["js-add-note"],foldCls:["fold-notes","show-all-notes"],delCls:["js-del-note"],entityId:t,entityType:e,ok:function(){p.tips("操作成功")}})},initResize:function F(){var i=this,e=w(window),d=w("div.nk-main"),o=d.find("div.js-topic-menu").css("zIndex",999),a=o.find("div.terminal-topic-wrap"),r=o.find(".js-list"),s=d.find(".js-left"),n=d.find(".js-right"),l=n.children(),c=n.find("#jsCodeEditor"),u=s.find(".full-separator").css("zIndex",998);function t(){if(!i.codeEditor||!i.codeEditor.isFullScreen){d.outerHeight(e.height()).outerWidth(e.width()),s.addClass("code-body-hidden"),n.addClass("code-body-hidden");var t=d.height();f(t),function o(t){t=t||d.height(),s.outerHeight(t),t=s.height();var e=s.find(".terminal-topic-wrap").outerHeight();s.find("div.terminal-topic").outerHeight(t-e).css("overflow-y","auto");var i=s.find("div.terminal-topic"),n=s.find(".terminal-topic-wrap");i.width(n.outerWidth()-30),s.find("div.terminal-topic .oprt-tool").outerWidth(n.outerWidth()),u.css("right",0).css("left","auto").height(i.height()).css("top",e)}(t),h(t)}}function f(t){var e=r.scrollTop();t=t||d.height(),o.outerHeight(t);var i=r.height("auto").outerHeight(),n=a.outerHeight();r.outerHeight(i+t-n),r.scrollTop(e)}function h(t){t=t||d.height(),n.outerHeight(t),t=n.height();var e=0;C.forEach(l,function(t){"none"!==(t=w(t)).css("display")&&t.get(0)!==c.get(0)&&(e+=t.outerHeight())}),c.outerHeight(Math.max(100,t-e)),i.codeEditor&&i.codeEditor.resize(null,c.height()),i.resultEl.outerWidth(n.width()).outerHeight(Math.max(60,.2*t)),w("#jsRunInfo").outerHeight(i.resultEl.height())}w(document.body).addClass("code-body-hidden"),e.on("resize",function(){window.setTimeout(t,50)}),j.listen("resizeAll",t),j.listen("resizeMenu",f),j.listen("resizeRight",h),t()},initEditor:function R(){var t=this,n=t.pageInfo;if(t.isFront())var e=g.initFECodeEditor(d,{noAutoSize:!0,autoFixHeight:!0,questionId:n.questionId,supportLang:n.supportLang,langTpl:f.getTplFE(),codeEl:w("#jsCodeEditor"),runInfoEl:w("#jsRunInfo"),runCodeEl:w("#jsRunCode"),loadCodeEl:w("#jsLoadCode"),loadAcceptCodeEl:w("#jsLoadAcceptCode")});else var e=g.initCodeEditor(o,{noAutoSize:!0,autoFixHeight:!0,questionId:n.questionId,codeJudgeType:n.codeJudgeType,selfTestSystemCase:f.getExample(),runExtParam:{tagId:T.getParam("tagId"),doneQuestionId:T.getParam("ACMContestId")},statusExtParam:{isContestExercise:t.valExamMode()?"true":undefined},langTpl:f.getTpl(),codeEl:w("#jsCodeEditor"),runInfoEl:w("#jsRunInfo"),runCodeEl:w("#jsRunCode"),loadCodeEl:w("#jsLoadCode"),loadAcceptCodeEl:w("#jsLoadAcceptCode")});e.listen("beforeRunCode",function(){t.openTab()}),e.listen("fullScreen",function(t){!t&&j.fire("resizeAll")}),e.listen("runCodeSuccess",function(t){var e=T.getParams();e.tqId=n.nextTqId;var i=0<n.nextTqId?T.addParam(e,"/practice/"+n.nextTqUuid):"";q.play(),y.ac({seconds:t.seconds,memory:t.memory,uuid:n.uuid,answerUrl:"/questionTerminal/"+n.uuid,nextUrl:i})}),e.showResult=function(t,e,i){var n=this.rawConfig,o=n.tipEl;if(!(t=w.trim(t)))return o.html("").hide();o.css("color",!0===e?"#b6b79a":"#00bc9b");var d=i?"<div>自测结果</div>":"";d+=!1===e?'<div class="ico-passed">通过</div>':!0===e?'<div class="ico-unpass">不通过</div>':"",d+="<div>"+t.replace(/\n/g,"<br />")+"</div>",o.html(d)},t.codeEditor=e},initMenu:function k(){var s=this.pageInfo,t=w("div.js-topic-title"),e=w("div.js-topic-menu"),l=e.find(".js-list"),c=l.find("div.js-list-tips"),u=l.find("div.js-ul-list"),d=!0,a=!0;if(!s.tpId||"0"===s.tpId)return;var f,h,i,n=+s.tPage||1,p=n,g=n,m=!1,v=!1;function o(e){var i=+e.page||1,n=!!e.pre;(function o(t,e,i){var n=s.tpId;b.getTaQuestionList({query:{tpId:n,page:t},call:function(t){e&&e(t.data)},error:i})})(i=+i||1,function(t){!function r(t,o,e){var i=w('<ul class="js-page-'+o+'"></ul>'),d="",a=T.getParams();C.forEach(t,function(t){var e=t.qstatus,i=window.location.pathname.split("/");i[i.length-1]=t.quuid,a.tqId=t.tqId,a.tPage=o;var n=T.addParam(a,i.join("/"));d+=I.execTpl(['<li class="#{liCls}">','<a class="topic-title-txt" href="#{href}">#{title}</a>','<span class="#{cls}"></span>',"</li>"].join(""),{title:t.qtitle,liCls:t.quuid===s.uuid?"active":"",cls:0===e?"icon-lock":1===e?"green-spot":"red-spot",href:n})}),d+="",c.hide(),i.html(d);var n=l.scrollTop();u[e?"prepend":"append"](i),n+=i.outerHeight(),j.fire("resizeMenu"),e&&l.scrollTop(n)}(t.data,i,n),i===p&&(u.find(".js-pre-tips").remove(),t.hasPre?(p=i-1,u.prepend('<div class="js-pre-tips" style="text-align:center;">加载中...</div>')):(p=null,h&&h()),v=!1),i===g&&(u.find(".js-next-tips").remove(),t.hasNext?(g=i+1,u.append('<div class="js-next-tips" style="text-align:center;">加载中...</div>')):(g=null,f&&f()),m=!1),a&&window.setTimeout(E,1e3),a=!1,e.call&&e.call(t)},function(t){a&&(c.html(t.msg),d=!0)})}function E(){window.setTimeout(function(){h=x.scrollTop(30,l,function(e){!v&&p&&o({page:p,pre:!0,call:function(t){t.hasPre&&e&&e()}}),v=!0})},2e3),f=x.scrollBottom(30,l,u,function(e){!m&&g&&o({page:g,pre:!1,call:function(t){t.hasNext&&e&&e()}}),m=!0})}C.forEach([t,e],function(t){x.hover(t,function(){clearTimeout(i),e.slideDown(200,function(){j.fire("resizeMenu")}),d&&o({page:s.tPage}),d=!1},function(){clearTimeout(i),i=window.setTimeout(C.bind(e.hide,e),200)})})},initDragDrop:function L(){var a=this,t=w(".js-fold"),r=a.resultEl,s=w(".js-right"),l=s.find("#jsCodeEditor"),c=s.children(),e=t.find("a");function i(){return!(e.hasClass("icon-angle-up")||a.codeEditor&&a.codeEditor.isFullScreen)}new u({drag:t,listeners:[{name:"start",handler:function(){i()&&(this._bottomHeight=r.outerHeight(),t.attr(H,"1"))}},{name:"drag",handler:function(){if(i()){var t=this._downY-this._moveY;!function d(t,e){var i=s.height(),t=Math.max(60,t+e),n=0;C.forEach(c,function(t){(t=w(t)).get(0)!==l.get(0)&&t.get(0)!==r.get(0)&&(n+=t.outerHeight())});var o=i-n-t;o<100&&(t=i-n-(o=100));l.outerHeight(o),a.codeEditor&&a.codeEditor.resize(null,l.height()),r.outerHeight(t),w("#jsRunInfo").outerHeight(a.resultEl.height())}(this._bottomHeight,t)}}},{name:"drop",handler:function(){i()&&(this._bottomHeight=null,window.setTimeout(function(){t.removeAttr(H)},0))}}]})},initDragSplit:function U(){var e,i,t=w(".full-separator"),n=w("div.nk-main"),o=n.find(".js-left"),d=n.find(".js-right");new u({drag:t,listeners:[{name:"start",handler:function(){this.offset=t.offset(),e=o.width(),i=d.width()}},{name:"drag",handler:function(){var t=this._moveX-this._downX;o.width()<=250&&t<0||d.width()<=550&&0<t||(o.width(e+t),d.width(i-t),d.css("marginLeft",e+t),j.fire("resizeAll"))}},{name:"drop",handler:function(){this.offset=null}}]})},openTab:function _(t){var e=w(".js-fold");t=!1!==t,"1"!==e.attr(H)&&(x.cls(e.find("a"),{"icon-angle-down":t,"icon-angle-up":!t}),this.resultEl[t?"show":"hide"](),e.css("cursor",t?"ns-resize":"pointer"),j.fire("resizeRight"))},isFront:function J(){return"2"===C.id(this.pageInfo.codeJudgeType)},valExamMode:function W(t){var e="taSubmitExamMode";if(0===arguments.length)return"1"===s.get(e);t&&s.set(e,"1"),!t&&s.remove(e)}})});